<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è ‚Äî –ë—É–ª—å–π–æ–Ω–Ω–∏–π –º–∞–Ω—ñ—è–∫</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="site-root">
  <header class="site-header">
      <a class="brand" href="index.html"><img src="./img/–ë—É–ª—å–π–æ–Ω–Ω–∏–π_–º–∞–Ω—å—è–∫-–ª–æ–≥–æ.png" alt="logo"></a>
      <nav>
      <a href="menu.html">–ú–µ–Ω—é</a>
      <a href="about.html">–ü—Ä–æ –Ω–∞—Å</a>
      <a href="contact.html">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
      <a class="cart-link" href="cart.html">–ö–æ—à–∏–∫ (<span id="cart-count">0</span>)</a>
    </nav>
  </header>
  <main class="container first-srean">

<h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
<form id="checkout-form" class="card">
  <div style="margin-bottom:10px">
    <label>–Ü–º'—è</label>
    <input name="name" id="userName" required style="width:100%; padding:8px; border-radius:6px;">
  </div>
  <div style="margin-bottom:10px">
    <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
    <input name="phone" id="userPhone" required style="width:100%; padding:8px; border-radius:6px;">
  </div>
  <div style="margin-bottom:10px">
    <label>–ê–¥—Ä–µ—Å–∞</label>
    <input name="address" id="userAddress" required style="width:100%; padding:8px; border-radius:6px;">
  </div>
  <div style="margin-bottom:10px">
    <p>–°—É–º–∞: <strong id="checkout-total">0</strong> –≥—Ä–Ω</p>
  </div>
  <button class="btn" type="submit">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
</form>

<div id="order-result" class="card" style="margin-top:12px; display:none"></div>
<script src="/js/toast.js"></script>
<script>
const cart = JSON.parse(localStorage.getItem('bm_cart') || '[]');
const total = cart.reduce((sum, item) => sum + item.price * item.qty, 0);
document.getElementById('checkout-total').textContent = Math.round(total);

const BOT_TOKEN = '8531254926:AAFe4eOXuBEtJBlKMUwpczmUiLyT7eyuYvo';
const CHAT_ID = '-1003249595740';
const API_URL = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;

document.getElementById('checkout-form').addEventListener('submit', function (e) {
  e.preventDefault();

  if (cart.length === 0) {
    toast.error('–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π!');
    return;
  }

  const name = document.getElementById('userName').value.trim();
  const phone = document.getElementById('userPhone').value.trim();
  const address = document.getElementById('userAddress').value.trim();

  if (!name || !phone || !address) {
    toast.error('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è!');
    return;
  }

  function generateOrderId() {
  const now = new Date();
  const day = String(now.getDate()).padStart(2, '0');
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const year = String(now.getFullYear()).slice(-2); 
  const serial = String(Math.floor(Math.random() * 900 + 100)); 
  return `ORD-${day}${month}${year}-${serial}`;
}

const orderId = generateOrderId();

  let message = `üçú <b>–ù–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!</b>\n`;
  message += `üÜî <b>ID:</b> ${orderId}\n`;
  message += `üë§ <b>–Ü–º‚Äô—è:</b> ${name}\n`;
  message += `üìû <b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> ${phone}\n`;
  message += `üè† <b>–ê–¥—Ä–µ—Å–∞:</b> ${address}\n`;
  message += `üí∞ <b>–°—É–º–∞:</b> ${total} –≥—Ä–Ω\n\n`;
  message += `üßæ <b>–°–∫–ª–∞–¥ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</b>\n`;
  cart.forEach((item) => {
    message += `- ${item.title} x${item.qty} = ${Math.round(item.price * item.qty)} –≥—Ä–Ω\n`;
  });

  fetch(API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      chat_id: CHAT_ID,
      text: message,
      parse_mode: 'HTML'
    })
  })
    .then((res) => res.json())
    .then((data) => {
      if (data.ok) {
        toast.success('‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ!');
        document.getElementById('order-result').style.display = 'block';
        document.getElementById('order-result').innerHTML =
          '<h3>–î—è–∫—É—î–º–æ! –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–æ üíñ</h3>';
        localStorage.removeItem('bm_cart');
        document.getElementById('checkout-form').reset();
        document.getElementById('checkout-total').textContent = '0';
      } else {
        toast.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!');
      }
    })
    .catch((err) => {
      toast.error('–ü–æ–º–∏–ª–∫–∞: ' + err.message);
    });
});

</script>

  </main>
  <footer class="site-footer card">
    <p>¬© 2025 –ë—É–ª—å–π–æ–Ω–Ω–∏–π –º–∞–Ω—ñ—è–∫ ‚Äî –†–∞–º–µ–Ω —É —Å–µ—Ä—Ü—ñ –º—ñ—Å—Ç–∞</p>
  </footer>
  </div>
  <script src="js/background.js"></script>
</body>
</html>